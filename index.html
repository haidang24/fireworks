<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interactive Fireworks</title>
    <link rel="shortcut icon" href="public/speed.png" type="image/x-icon" />
    <style>
      body {
        margin: 0;
        background-color: #000;
        overflow: hidden;
      }
      #controls {
        background-color: rgb(255, 255, 255, 0.2);
        padding: 10px;
        border-radius: 20px;
        position: fixed;
        top: 10px;
        left: 10px;
        color: white;
        font-family: Arial, sans-serif;
        display: flex;
        gap: 20px;
        align-items: center;
      }
      #speed-slider {
        -webkit-appearance: none;
        width: 150px;
        height: 8px;
        background: linear-gradient(to right, #4caf50, #f44336);
        border-radius: 20px;
        outline: none;
        transition: background 0.3s;
        /* boxshadow */
        box-shadow: 0px 2px 4px 0px rgba(255, 255, 255, 0.3);
      }
      #speed-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 15px;
        height: 15px;
        background: hsl(0, 0%, 100%);
        border-radius: 50%;
        cursor: pointer;
      }
      #mute-btn {
        background: linear-gradient(to right, #ff05ea, #ff1302);
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 14px;
        font-weight: bold;
      }
      #mute-btn.muted {
        background-color: #4caf50;
      }
    </style>
  </head>
  <body>
    <div id="controls">
      <label style="color: #ffffff; font-weight: bold"
        >Speed:
        <input id="speed-slider" type="range" min="1" max="10" value="2"
      /></label>
      <button id="mute-btn">Mute</button>
    </div>
    <canvas id="fireworks"></canvas>
    <script>
      const canvas = document.getElementById("fireworks");
      const ctx = canvas.getContext("2d");
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      let speedMultiplier = 2;
      let isMuted = false;

      class Firework {
        constructor(x, y, targetX, targetY) {
          this.x = x;
          this.y = y;
          this.targetX = targetX;
          this.targetY = targetY;
          this.speed = speedMultiplier;
          this.angle = Math.atan2(targetY - y, targetX - x);
          this.distance = Math.sqrt((targetX - x) ** 2 + (targetY - y) ** 2);
          this.traveled = 0;
          this.exploded = false;
          this.particles = [];
          this.color = `hsl(${Math.random() * 360}, 100%, 60%)`;
        }

        update() {
          if (!this.exploded) {
            this.x += Math.cos(this.angle) * this.speed;
            this.y += Math.sin(this.angle) * this.speed;
            this.traveled += this.speed;

            if (this.traveled >= this.distance) {
              this.explode();
            }
          }

          this.particles = this.particles.filter(
            (particle) => particle.opacity > 0
          );
          this.particles.forEach((particle) => particle.update());
        }

        explode() {
          this.exploded = true;
          if (!isMuted) playExplosionSound();
          // Tăng số lượng hạt
          for (let i = 0; i < 120; i++) {
            this.particles.push(new Particle(this.x, this.y, this.color));
          }
        }

        draw() {
          if (!this.exploded) {
            ctx.beginPath();
            ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
            ctx.fillStyle = this.color;
            ctx.fill();
          }
          this.particles.forEach((particle) => particle.draw());
        }
      }

      class Particle {
        constructor(x, y, color) {
          this.x = x;
          this.y = y;
          this.color = color;
          this.angle = Math.random() * Math.PI * 2;
          // this.speed = Math.random() * 6 + 2;
          this.speed = Math.random() * 8 + 4; // Tăng tốc độ từ (6, 2) lên (8, 4)
          this.gravity = 0.1;
          this.opacity = 1;
          this.fade = Math.random() * 0.02 + 0.01;
          // this.size = Math.random() * 3 + 1;
          this.size = Math.random() * 5 + 3; // Tăng kích thước tu (3, 1) lên (5, 3)
          this.sparkle = Math.random() > 0.5 ? 1 : 0;
          this.shape = Math.random() > 0.5 ? "circle" : "star";
        }

        update() {
          this.x += Math.cos(this.angle) * this.speed;
          this.y += Math.sin(this.angle) * this.speed + this.gravity;
          this.opacity -= this.fade;
          this.size *= 0.96;
          if (this.opacity <= 0) this.opacity = 0;
        }

        draw() {
          if (this.opacity > 0) {
            ctx.globalAlpha = this.opacity;
            ctx.fillStyle = this.color;
            //
            ctx.shadowBlur = 10; // Ánh sáng phát ra
            ctx.shadowColor = this.color; // Màu phát sáng
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowBlur = 0; // Tắt hiệu ứng sau khi vẽ
            ctx.globalAlpha = 1;

            if (this.shape === "circle") {
              ctx.beginPath();
              ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
              ctx.fill();
            } else if (this.shape === "star") {
              ctx.beginPath();
              for (let i = 0; i < 5; i++) {
                const angle = (i * (Math.PI * 2)) / 5;
                const x = this.x + Math.cos(angle) * this.size;
                const y = this.y + Math.sin(angle) * this.size;
                ctx.lineTo(x, y);
              }
              ctx.closePath();
              ctx.fill();
            }

            if (this.sparkle && Math.random() > 0.7) {
              ctx.beginPath();
              ctx.arc(this.x, this.y, this.size / 2, 0, Math.PI * 2);
              ctx.fillStyle = "#fff";
              ctx.fill();
            }

            ctx.globalAlpha = 1;
          }
        }
      }

      const fireworks = [];

      function createFirework(x, y) {
        const targetX = x;
        const targetY = y;
        fireworks.push(
          new Firework(
            Math.random() * canvas.width,
            canvas.height,
            targetX,
            targetY
          )
        );
      }

      let lastFireworkTime = 0;
      const fireworkInterval = 500; // ms

      function animate(timestamp) {
        ctx.fillStyle = "rgba(0, 0, 0, 0.1)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        if (timestamp - lastFireworkTime > fireworkInterval) {
          createFirework(
            Math.random() * canvas.width,
            (Math.random() * canvas.height) / 2
          );
          lastFireworkTime = timestamp;
        }

        for (let i = fireworks.length - 1; i >= 0; i--) {
          fireworks[i].update();
          fireworks[i].draw();
          if (fireworks[i].exploded && fireworks[i].particles.length === 0) {
            fireworks.splice(i, 1);
          }
        }

        requestAnimationFrame(animate);
      }

      canvas.addEventListener("click", (e) => {
        createFirework(e.clientX, e.clientY);
      });

      document.getElementById("speed-slider").addEventListener("input", (e) => {
        speedMultiplier = parseFloat(e.target.value);
        e.target.style.background = `linear-gradient(to right, #4caf50 ${
          (speedMultiplier - 1) * 11.1
        }%, #f44336 ${(speedMultiplier - 1) * 11.1}%)`;
      });

      document.getElementById("mute-btn").addEventListener("click", (e) => {
        isMuted = !isMuted;
        e.target.classList.toggle("muted");
        e.target.textContent = isMuted ? "Unmute" : "Mute";
      });

      function playExplosionSound() {
        const audio = new Audio("public/fireworks.mp3");
        audio.volume = 0.5;
        audio.play();
      }

      requestAnimationFrame(animate);
    </script>
  </body>
</html>
